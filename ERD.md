# ---------------------------------------------------------------------- `ERD – Web Bán Khóa Học` -----------------------------------------------------------------------
 = 1️⃣ `Bảng chính & quan hệ`
 =
 =        |      `Bảng`      | `Key chính` |                                                 `Quan hệ chính`                                                      |
 =        | ---------------- | ----------- | -------------------------------------------------------------------------------------------------------------------- |
 =        | **users**        |    `id`     | 1 user có thể tạo nhiều **orders**, **reviews**, **certificates**, **enrollments**                                   |
 =        | **roles**        |    `id`     | 1 role → nhiều users                                                                                                 |
 =        | **profiles**     |    `id`     | 1:1 với user (`userId`)                                                                                              |
 =        | **categories**   |    `id`     | 1 category → nhiều courses                                                                                           |
 =        | **courses**      |    `id`     | 1 course → nhiều lessons, enrollments, reviews, certificates; thuộc 1 category; do 1 instructor tạo (`instructorId`) |
 =        | **lessons**      |    `id`     | 1 lesson → thuộc 1 course                                                                                            |
 =        | **orders**       |    `id`     | 1 order → nhiều order_items; 1 order → nhiều payments; 1 order → 1 coupon (tùy)                                      |
 =        | **order_items**  |    `id`     | 1 order_item → 1 course, thuộc 1 order                                                                               |
 =        | **payments**     |    `id`     | 1 payment → thuộc 1 order                                                                                            |
 =        | **enrollments**  |    `id`     | 1 enrollment → 1 user, 1 course, optional `orderItemId`                                                              |
 =        | **coupons**      |    `id`     | optional → áp dụng cho order                                                                                         |
 =        | **certificates** |    `id`     | 1 certificate → 1 user, 1 course                                                                                     |
 =        | **reviews**      |    `id`     | 1 review → 1 user, 1 course                                                                                          |
 =
 = 2️⃣ `Quan hệ trực tiếp (FK)`
 =
 =        users.id → orders.userId
 =        users.id → profiles.userId
 =        users.id → reviews.userId
 =        users.id → certificates.userId
 =        users.id → enrollments.userId
 =
 =        roles.id → users.roleId
 =
 =        categories.id → courses.categoryId
 =
 =        courses.id → lessons.courseId
 =        courses.id → order_items.courseId
 =        courses.id → enrollments.courseId
 =        courses.id → reviews.courseId
 =        courses.id → certificates.courseId
 =        courses.instructorId → users.id
 =
 =        orders.id → order_items.orderId
 =        orders.id → payments.orderId
 =        orders.couponId → coupons.id
 =
 =        order_items.id → enrollments.orderItemId (optional)
 =
 = 3️⃣ `Quan hệ gián tiếp`
 =      
 =        payments → orders → users: biết học viên đã thanh toán.
 =
 =        payments → orders → order_items → courses → enrollments: xác định khóa học đã được unlock cho học viên.
 =
 =        orders + coupons: áp dụng giảm giá.
 =
 = 4️⃣ `Hình trực quan ERD (mình mô tả dạng ASCII diagram)`
 =        
 =        roles
 =          |
 =          | 1:N
 =          v
 =        users --------------------+
 =          | 1:N                   |
 =          v                       |
 =        profiles                orders ---------------------+
 =                                  | 1:N                     |
 =                                  v                         v
 =                                order_items               payments
 =                                  |
 =                                  v
 =                                courses --------------+
 =                                  | 1:N               |
 =                                  v                   |
 =                                lessons           enrollments
 =                                  |                   ^
 =                                  |                   |
 =                                reviews <-------------+
 =                                  |
 =                             certificates
 =          categories --------> courses
 =    
 = 5️⃣ `Lưu ý thiết kế`
 =
 =          *1*. `payments tách riêng`:
 =              . Cho phép retry, partial, refund.
 =              . Không trộn payment info trong order để tránh rối.
 =          *2*. `enrollments`:
 =              . Khi payment thành công → backend tạo enrollment → học viên có quyền truy cập khóa.
 =          *3*. `order_items`:
 =              . Hỗ trợ mua nhiều khóa trong 1 order.
 =          *4*. `coupons`:
 =              . Liên kết với order → payment metadata có thể lưu coupon áp dụng.
 =
# ---------------------------------------------------------------------- `ERD – Web Bán Khóa Học` -----------------------------------------------------------------------